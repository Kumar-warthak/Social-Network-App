public static string GetAccessTokenForSharePoint(string tenantId, string clientId, string clientSecret)
{
    string tokenEndpoint = $"https://login.microsoftonline.com/{tenantId}/oauth2/v2.0/token";
    string scope = $"https://yourtenant.sharepoint.com/.default";  // Replace with your real tenant domain

    string postData = $"grant_type=client_credentials" +
                      $"&client_id={clientId}" +
                      $"&client_secret={Uri.EscapeDataString(clientSecret)}" +
                      $"&scope={Uri.EscapeDataString(scope)}";

    byte[] data = Encoding.UTF8.GetBytes(postData);

    HttpWebRequest request = (HttpWebRequest)WebRequest.Create(tokenEndpoint);
    request.Method = "POST";
    request.ContentType = "application/x-www-form-urlencoded";
    request.ContentLength = data.Length;

    using (Stream stream = request.GetRequestStream())
        stream.Write(data, 0, data.Length);

    using (WebResponse response = request.GetResponse())
    using (StreamReader reader = new StreamReader(response.GetResponseStream()))
    {
        string json = reader.ReadToEnd();
        var serializer = new JavaScriptSerializer();
        var dict = serializer.Deserialize<Dictionary<string, object>>(json);
        return dict["access_token"].ToString();
    }
}
