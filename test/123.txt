
import React, { useState } from "react";
import brokerage from "./metadataJson/brokerage.json";
import wimClient from "./metadataJson/wimClient.json";

const MetadataWidget = (props) => {
  const [openDataset, setOpenDataset] = useState(null);
  const [openTable, setOpenTable] = useState(null);

  const datasets = [
    { name: "Brokerage Dataset", data: brokerage },
    { name: "WIM Client Dataset", data: wimClient },
  ];

  const toggleDataset = (datasetName) => {
    setOpenDataset(openDataset === datasetName ? null : datasetName);
    setOpenTable(null); // reset table when changing dataset
  };

  const toggleTable = (tableName) => {
    setOpenTable(openTable === tableName ? null : tableName);
  };

  return (
    <div style={{ padding: "10px" }}>
      {datasets.map((dataset, idx) => (
        <div
          key={idx}
          style={{
            marginBottom: "10px",
            border: "1px solid #28a745",
            borderRadius: "6px",
            overflow: "hidden",
            background: "#f9fff9",
          }}
        >
          {/* Dataset Header */}
          <button
            onClick={() => toggleDataset(dataset.name)}
            style={{
              width: "100%",
              textAlign: "left",
              padding: "10px",
              background: "#e8f5e9",
              border: "none",
              cursor: "pointer",
              fontWeight: "bold",
            }}
          >
            {dataset.name} {openDataset === dataset.name ? "â–²" : "â–¼"}
          </button>

          {/* Dataset Content */}
          {openDataset === dataset.name && (
            <div style={{ padding: "10px", background: "#fff", borderTop: "1px solid #28a745" }}>
              <p><strong>Server:</strong> {dataset.data.serverName}</p>
              <p><strong>Database:</strong> {dataset.data.database}</p>
              <p><strong>Schema:</strong> {dataset.data.schema}</p>

              {/* Tables Accordion */}
              {dataset.data.tables?.map((table, i) => (
                <div
                  key={i}
                  style={{
                    marginTop: "10px",
                    border: "1px solid #28a745",
                    borderRadius: "6px",
                    overflow: "hidden",
                    background: "#f0fff0",
                  }}
                >
                  <button
                    onClick={() => toggleTable(table.name)}
                    style={{
                      width: "100%",
                      textAlign: "left",
                      padding: "8px",
                      background: "#d0f0d0",
                      border: "none",
                      cursor: "pointer",
                      fontWeight: "bold",
                    }}
                  >
                    {table.name} {openTable === table.name ? "â–²" : "â–¼"}
                  </button>

                  {openTable === table.name && (
                    <div style={{ padding: "8px", background: "#fff", borderTop: "1px solid #28a745" }}>
                      <p><strong>Description:</strong> {table.description}</p>
                      <p><strong>Columns:</strong></p>
                      <ul style={{ paddingLeft: "20px", margin: 0 }}>
                        {table.columns?.map((col, j) => (
                          <li key={j}>
                            <strong>{col.name}</strong>: {col.description}
                          </li>
                        ))}
                      </ul>
                    </div>
                  )}
                </div>
              ))}
            </div>
          )}
        </div>
      ))}

      <button
        onClick={props.actionProvider.clearChat}
        style={{
          marginTop: "10px",
          padding: "6px 12px",
          borderRadius: "6px",
          border: "1px solid #28a745",
          background: "#f0fff0",
          cursor: "pointer",
        }}
      >
        ðŸ”„ Back to Main Menu
      </button>
    </div>
  );
};

export default MetadataWidget;
