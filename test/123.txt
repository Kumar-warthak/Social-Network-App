<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SQL Query Analysis</title>
  <style>
    table, th, td {
      border: 1px solid black;
      border-collapse: collapse;
      padding: 8px;
      vertical-align: top;
    }
    th {
      background-color: #f2f2f2;
    }
    .nested-table {
      border: none;
    }
    .nested-table td {
      border: none;
      padding: 2px 4px;
    }
  </style>
</head>
<body>
  <h2>SQL Query Analysis</h2>
  <div id="table-container"></div>

  <script>
    async function renderSQLAnalysis(query) {
      const res = await fetch('http://127.0.0.1:5000/analyze-sql', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ query: query })
      });

      const data = await res.json();

      const container = document.getElementById('table-container');

      let html = `
        <table>
          <tr>
            <th>Query Logic</th>
            <th>Schema</th>
            <th colspan="2">Table with columns</th>
            <th>Joins</th>
            <th>Where Statement</th>
          </tr>
          <tr>
            <td rowspan="2">${data.query}</td>
            <td rowspan="2">${data.schema}</td>
            <td><b>Tables</b></td>
            <td><b>Columns</b></td>
            <td rowspan="2">${data.joins}</td>
            <td rowspan="2">${data.where}</td>
          </tr>
      `;

      for (const table of data.tables) {
        html += `
          <tr>
            <td>${table.name}</td>
            <td>${table.columns.join(',')}</td>
          </tr>
        `;
      }

      html += `</table>`;
      container.innerHTML = html;
    }

    // Replace with your actual query
    renderSQLAnalysis("SELECT * FROM aaa INNER JOIN bbb ON aaa.id = bbb.id WHERE aaa.id = 1");
  </script>
</body>
</html>
