<!DOCTYPE html>
<html>
<head>
  <title>SQL Analysis Viewer</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .json-key { font-weight: bold; margin-top: 10px; }
    .json-value { margin-left: 20px; }
  </style>
</head>
<body class="p-4">

  <h3 class="mb-3">SQL Analysis</h3>
  
  <textarea id="sqlDisplay" class="form-control mb-3" rows="4" readonly></textarea>
  <button class="btn btn-primary mb-3" onclick="fetchSQLAnalysis()">Fetch SQL Analysis</button>

  <div id="result" class="accordion" id="jsonAccordion"></div>

  <script>
    function renderJSON(data, parentId) {
      let html = '';

      Object.entries(data).forEach(([key, value], index) => {
        const collapseId = `${parentId}-${index}`;
        if (typeof value === 'object' && value !== null && !Array.isArray(value)) {
          html += `
            <div class="accordion-item">
              <h2 class="accordion-header" id="heading-${collapseId}">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-${collapseId}">
                  ${key}
                </button>
              </h2>
              <div id="collapse-${collapseId}" class="accordion-collapse collapse" data-bs-parent="#${parentId}">
                <div class="accordion-body">
                  ${renderJSON(value, collapseId)}
                </div>
              </div>
            </div>
          `;
        } else {
          html += `
            <h3 class="json-key">${key}</h3>
            <p class="json-value">${Array.isArray(value) ? value.join(', ') : value}</p>
          `;
        }
      });

      return html;
    }

    function fetchSQLAnalysis() {
      fetch('/sql-analysis')  // 🔁 Make sure your backend responds at this endpoint
        .then(response => response.json())
        .then(data => {
          document.getElementById('sqlDisplay').value = JSON.stringify(data, null, 2);
          document.getElementById('result').innerHTML = renderJSON(data, 'jsonAccordion');
        })
        .catch(error => console.error('Error:', error));
    }
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
