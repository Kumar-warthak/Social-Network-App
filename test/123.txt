<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SQL Analyzer</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 40px;
    }
    textarea {
      width: 100%;
      height: 100px;
    }
    button {
      padding: 10px 20px;
      margin-top: 10px;
      font-size: 16px;
    }
    .output-section {
      margin-top: 30px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: left;
    }
    th {
      background-color: #f3f3f3;
    }
  </style>
</head>
<body>

<h2>SQL Query Analyzer</h2>
<form id="queryForm">
  <label for="sql">Enter SQL Query:</label><br>
  <textarea id="sql" name="sql" placeholder="SELECT * FROM table_name;"></textarea><br>
  <button type="submit">Analyze</button>
</form>

<div class="output-section" id="result"></div>

<script>
document.getElementById('queryForm').addEventListener('submit', async function (e) {
  e.preventDefault();
  const query = document.getElementById('sql').value;
  const responseDiv = document.getElementById('result');
  responseDiv.innerHTML = 'Analyzing...';

  try {
    const res = await fetch('http://127.0.0.1:5000/analyze-sql', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ query: query })
    });

    const data = await res.json();

    if (Array.isArray(data) && data.length > 0) {
      const obj = data[0];

      let html = `
        <p><strong>Query Logic:</strong> ${obj.queryLogic}</p>
        <p><strong>Schema:</strong> ${obj.schema}</p>
        <p><strong>Joins:</strong> ${obj.joins}</p>
        <p><strong>Where:</strong> ${obj.where}</p>
      `;

      if (obj.tables) {
        html += '<h3>Tables and Columns</h3>';
        html += '<table><tr><th>Table</th><th>Columns</th></tr>';
        for (let table in obj.tables) {
          const cols = obj.tables[table].join(', ');
          html += `<tr><td>${table}</td><td>${cols}</td></tr>`;
        }
        html += '</table>';
      }

      responseDiv.innerHTML = html;
    } else {
      responseDiv.innerHTML = '<p>No structured data returned.</p>';
    }
  } catch (err) {
    responseDiv.innerHTML = `<p style="color: red;">Error: ${err.message}</p>`;
  }
});
</script>

</body>
</html>
