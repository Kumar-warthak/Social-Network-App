<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SQL Query Analysis</title>
  <style>
    table, th, td {
      border: 1px solid black;
      border-collapse: collapse;
      padding: 8px;
    }
    th {
      background-color: #f2f2f2;
    }
  </style>
</head>
<body>
  <h2>SQL Query Analysis</h2>
  <button onclick="fetchData()">Get SQL Analysis</button>
  <br><br>
  <table id="sqlTable">
    <thead>
      <tr>
        <th>Query Logic</th>
        <th>Schema</th>
        <th>Table with columns</th>
        <th>Joins</th>
        <th>Where Statement</th>
      </tr>
    </thead>
    <tbody id="tableBody"></tbody>
  </table>

  <script>
    async function fetchData() {
      const response = await fetch("http://localhost:5000/analyze", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({ sqldata: "mock" })
      });

      const data = await response.json();

      const tableBody = document.getElementById("tableBody");
      tableBody.innerHTML = ""; // clear any existing rows

      const tableRows = data.tables.map(t =>
        `<tr><td colspan="2">${t.table}</td><td colspan="3">${t.columns.join(", ")}</td></tr>`
      ).join("");

      const mainRow = `
        <tr>
          <td rowspan="${data.tables.length + 1}">${data.queryLogic}</td>
          <td rowspan="${data.tables.length + 1}">${data.schema}</td>
          <td colspan="3"></td>
          <td rowspan="${data.tables.length + 1}">${data.joins}</td>
          <td rowspan="${data.tables.length + 1}">${data.where}</td>
        </tr>
        ${tableRows}
      `;

      tableBody.innerHTML = mainRow;
    }
  </script>
</body>
</html>
