<textarea id="sqlDisplay" readonly style="width: 100%; height: 200px;"></textarea>
<div id="outputContainer"></div>
<button onclick="fetchSQLData()">Fetch SQL Info</button>

<script>
const displayOrder = [
  { key: "schema", label: "Schema" },
  { key: "tables", label: "Tables" },
  { key: "joins", label: "Joins" },
  { key: "where", label: "Where Clause" },
  { key: "queryLogic", label: "Query Logic" }
];

function renderTable(obj) {
  let html = '';
  for (const tableName in obj) {
    html += `<h4>${tableName}</h4>`;
    html += `<table border="1" cellpadding="5" cellspacing="0"><tr>`;
    obj[tableName].forEach(col => {
      html += `<th>${col}</th>`;
    });
    html += `</tr></table>`;
  }
  return html;
}

function formatValue(key, value) {
  if (key === "tables" && typeof value === "object") {
    return renderTable(value);
  } else if (typeof value === "object") {
    return "<pre>" + JSON.stringify(value, null, 2) + "</pre>";
  }
  return "<p>" + value + "</p>";
}

function fetchSQLData() {
  fetch("http://localhost:5000/api/sqldata", {
    method: "POST",
    headers: {
      "Content-Type": "application/json"
    },
    body: JSON.stringify({ key: "sqldata" })
  })
  .then(response => response.json())
  .then(data => {
    const output = displayOrder.map(item => {
      if (data[item.key] !== undefined) {
        return `<h3>${item.label}</h3>${formatValue(item.key, data[item.key])}`;
      }
      return "";
    }).join("");
    document.getElementById("outputContainer").innerHTML = output;
    document.getElementById("sqlDisplay").value = ""; // stays empty
  })
  .catch(error => {
    console.error("Error fetching SQL data:", error);
  });
}
</script>
