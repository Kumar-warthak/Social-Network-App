using System;
using System.Data;
using System.IO;
using Microsoft.SqlServer.Dts.Runtime;
using System.Text;

public void Main()
{
    // Define file path
    string filePath = Dts.Variables["User::FilePath"].Value.ToString();

    // Read all lines from the CSV file
    var lines = File.ReadAllLines(filePath);

    // Split the header line
    var header = lines[0].Split(',');

    // Rename columns in the header if needed
    for (int i = 0; i < header.Length; i++)
    {
        if (header[i] == "OldDateColumn")
        {
            header[i] = "NewDateColumn";
        }
        if (header[i] == "OldColumnName1")
        {
            header[i] = "NewColumnName1";
        }
        if (header[i] == "OldColumnName2")
        {
            header[i] = "NewColumnName2";
        }
        // Add more column renames as needed
    }

    // Write back the updated header
    lines[0] = string.Join(",", header);

    // Process each data line
    for (int i = 1; i < lines.Length; i++)
    {
        var columns = lines[i].Split(',');

        // Assuming date is in the first column
        DateTime dateValue;
        if (DateTime.TryParse(columns[0], out dateValue))
        {
            columns[0] = dateValue.ToString("MM/dd/yyyy");
        }

        // Join the columns back into a line
        lines[i] = string.Join(",", columns);
    }

    // Write all lines back to the file
    File.WriteAllLines(filePath, lines, Encoding.UTF8);

    Dts.TaskResult = (int)ScriptResults.Success;
}
