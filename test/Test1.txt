function main(workbook: ExcelScript.Workbook, csvData: string, sheetName: string) {
  // Maximum number of rows to process in one chunk
  const CHUNK_SIZE = 5000;

  // Split CSV data into rows
  let rows = csvData.split("\n");
  
  // Handle edge case for empty CSV
  if (rows.length === 0) {
    throw new Error("The provided CSV data is empty.");
  }

  // Split the first row into headers
  let headers = rows[0].split(",");
  
  // Check if the sheet already exists
  let sheet = workbook.getWorksheet(sheetName);
  if (!sheet) {
    sheet = workbook.addWorksheet(sheetName);
  } else {
    sheet.getUsedRange()?.clear();
  }

  // Write headers to the sheet
  sheet.getRange(1, 1, 1, headers.length).setValues([headers]);

  // Process rows in chunks
  for (let startRow = 1; startRow < rows.length; startRow += CHUNK_SIZE) {
    // Extract the current chunk
    let endRow = Math.min(startRow + CHUNK_SIZE, rows.length);
    let chunk = rows.slice(startRow, endRow);

    // Split each row in the chunk into columns
    let chunkData = chunk.map(row => row.split(","));

    // Write the chunk to the worksheet
    sheet.getRange(startRow + 1, 1, chunkData.length, headers.length).setValues(chunkData);
  }

  // Autofit columns for better visibility
  sheet.getUsedRange()?.getFormat()?.autofitColumns();
}
