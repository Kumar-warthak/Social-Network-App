import pandas as pd
from office365.sharepoint.client_context import ClientContext
from office365.runtime.auth.client_credential import ClientCredential

# Constants
SITE_URL = "https://yourtenant.sharepoint.com/sites/yoursite"
CLIENT_ID = "your-client-id"
CLIENT_SECRET = "your-client-secret"
LIST_NAME = "YourListName"

# Authenticate
def get_context(site_url, client_id, client_secret):
    credentials = ClientCredential(client_id, client_secret)
    ctx = ClientContext(site_url).with_credentials(credentials)
    return ctx

# Create list items from DataFrame
def insert_dataframe_to_sharepoint(context, list_name, dataframe):
    sp_list = context.web.lists.get_by_title(list_name)
    for _, row in dataframe.iterrows():
        # Convert row to dictionary
        item_data = row.to_dict()
        # Add SharePoint metadata
        item_data["__metadata"] = {"type": f"SP.Data.{list_name}ListItem"}
        sp_list.add_item(item_data).execute_query()
        print(f"Inserted: {item_data}")

# Example Usage
if __name__ == "__main__":
    try:
        # Example DataFrame
        data = {
            "Title": ["Item 1", "Item 2", "Item 3"],  # Replace 'Title' with column names in SharePoint
            "CustomColumn": ["Value1", "Value2", "Value3"],
        }
        df = pd.DataFrame(data)

        # Authenticate and insert data
        ctx = get_context(SITE_URL, CLIENT_ID, CLIENT_SECRET)
        insert_dataframe_to_sharepoint(ctx, LIST_NAME, df)
    except Exception as e:
        print("Error:", str(e))
