DECLARE @execution_id BIGINT;
DECLARE @folder_name NVARCHAR(128) = 'YourFolderName';
DECLARE @project_name NVARCHAR(128) = 'YourProjectName';
DECLARE @package_name NVARCHAR(260) = 'YourPackageName.dtsx';
DECLARE @environment_name NVARCHAR(128) = 'YourEnvironmentName'; -- Optional

-- 1. Create an execution instance
EXEC [SSISDB].[catalog].[create_execution] 
    @folder_name = @folder_name,
    @project_name = @project_name,
    @package_name = @package_name,
    @use32bitruntime = False,         -- Use 64-bit runtime by default
    @execution_id = @execution_id OUTPUT;

-- 2. Optionally set the environment reference if used
IF @environment_name IS NOT NULL
BEGIN
    DECLARE @reference_id BIGINT;
    
    -- Get the environment reference ID
    SELECT @reference_id = er.reference_id 
    FROM [SSISDB].[catalog].[environment_references] er
    INNER JOIN [SSISDB].[catalog].[projects] p
    ON er.project_id = p.project_id
    INNER JOIN [SSISDB].[catalog].[folders] f
    ON p.folder_id = f.folder_id
    WHERE f.name = @folder_name
      AND p.name = @project_name
      AND er.environment_name = @environment_name;

    -- Set the environment reference for the execution
    EXEC [SSISDB].[catalog].[set_execution_parameter_value]
        @execution_id = @execution_id,
        @object_type = 50, -- 50 = Package
        @parameter_name = N'ENVIRONMENT_REFERENCE',
        @parameter_value = @reference_id;
END

-- 3. Set package parameters if needed (optional)
-- Example for setting a parameter:
-- EXEC [SSISDB].[catalog].[set_execution_parameter_value]
--     @execution_id = @execution_id,
--     @object_type = 50, -- 50 = Package
--     @parameter_name = N'ParameterName',
--     @parameter_value = 'ParameterValue';

-- 4. Start the package execution
EXEC [SSISDB].[catalog].[start_execution] @execution_id;

-- Output the execution ID
PRINT 'Package execution started. Execution ID: ' + CAST(@execution_id AS NVARCHAR(20));
