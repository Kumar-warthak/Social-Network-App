Sub GenerateAndMergePDFsWithSkip()
    Dim ws As Worksheet
    Dim sourceRange As Range
    Dim cell As Range
    Dim outputColumn As Range
    Dim referenceColumn As Range
    Dim baseName As String
    Dim modifiedName As String
    Dim additionalText As String
    Dim row As Long
    Dim pdfFolder As String
    Dim fileNames As Collection
    Dim fileName As String
    Dim mergedPDF As String
    Dim objAcroApp As Object
    Dim objAcroPDDoc As Object
    Dim objAcroPDDocMerge As Object

    ' Set the worksheet and folder
    Set ws = ThisWorkbook.Sheets(1) ' Change as needed
    Set sourceRange = ws.Range("A2:A" & ws.Cells(ws.Rows.Count, "A").End(xlUp).Row) ' Column A for base names
    Set outputColumn = ws.Range("B2") ' Output starts in Column B
    Set referenceColumn = ws.Range("C2:C" & ws.Cells(ws.Rows.Count, "C").End(xlUp).Row) ' Column C for reference (Yes/No)
    pdfFolder = ThisWorkbook.Path & "\" ' PDFs should be in the same folder as the workbook

    ' Define the text to append
    additionalText = "_text"

    ' Collection to store PDF file names in order
    Set fileNames = New Collection

    ' Generate modified names and store in Column B, checking reference column
    row = 0
    For Each cell In sourceRange
        If cell.Value <> "" Then
            ' Get the base name
            baseName = cell.Value
            
            ' Check if reference column value is "Yes" (skip if "No")
            If referenceColumn.Cells(row + 1, 1).Value = "Yes" Then
                ' Generate the modified name
                modifiedName = baseName & additionalText & ".pdf"
                
                ' Write the modified name in the output column
                outputColumn.Offset(row, 0).Value = modifiedName
                
                ' Store the full path of the PDF
                fileNames.Add pdfFolder & modifiedName
            Else
                ' Write skipped message in the output column
                outputColumn.Offset(row, 0).Value = "Skipped"
            End If
            
            row = row + 1
        End If
    Next cell

    ' Output merged PDF path
    mergedPDF = pdfFolder & "MergedPDF.pdf"

    ' Merge PDFs in the order specified in Column B
    On Error Resume Next
    Set objAcroApp = CreateObject("AcroExch.App")
    Set objAcroPDDocMerge = CreateObject("AcroExch.PDDoc")
    On Error GoTo 0
    
    If objAcroApp Is Nothing Or objAcroPDDocMerge Is Nothing Then
        MsgBox "Adobe Acrobat is not available. Ensure it is installed.", vbCritical, "Error"
        Exit Sub
    End If
    
    ' Open the first PDF to initialize the merge
    If fileNames.Count > 0 Then
        Set objAcroPDDoc = CreateObject("AcroExch.PDDoc")
        objAcroPDDoc.Open fileNames(1)
        objAcroPDDocMerge.Open fileNames(1)
        objAcroPDDoc.Close
        
        ' Loop through the remaining PDFs and add them to the merged document
        For row = 2 To fileNames.Count
            Set objAcroPDDoc = CreateObject("AcroExch.PDDoc")
            objAcroPDDoc.Open fileNames(row)
            objAcroPDDocMerge.InsertPages objAcroPDDocMerge.GetNumPages - 1, objAcroPDDoc, 0, objAcroPDDoc.GetNumPages, False
            objAcroPDDoc.Close
        Next row
        
        ' Save the merged PDF
        objAcroPDDocMerge.Save 1, mergedPDF
        objAcroPDDocMerge.Close
        objAcroApp.Exit
        
        ' Clean up
        Set objAcroPDDoc = Nothing
        Set objAcroPDDocMerge = Nothing
        Set objAcroApp = Nothing
        
        MsgBox "All PDFs have been merged into: " & mergedPDF, vbInformation, "Merge Complete"
    Else
        MsgBox "No PDFs to merge. Please check the reference column.", vbInformation, "No PDFs to Merge"
    End If
End Sub
